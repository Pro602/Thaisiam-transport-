<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏ô‡∏™‡πà‡∏á</title>

    <!-- ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Å‡∏±‡∏ö manifest.json -->
    <link rel="manifest" href="/Thaisiam-transport-/manifest.json">

    <!-- ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÇ‡∏¢‡∏á‡∏Å‡∏±‡∏ö favicon -->
    <link rel="icon" href="favicon.ico?v=2">


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(120deg, #a8edea, #fed6e3);
            text-align: center;
            margin: 0;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: auto;
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        h2 {
            color: #007BFF;
            font-size: 22px;
            font-weight: bold;
        }
        
        .truck {
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        ul {
            list-style: none;
            padding: 0;
        }
        
        li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: #f4f4f4;
            padding: 10px;
            margin-bottom: 5px;
            border-radius: 5px;
        }
        
        .status {
            font-weight: bold;
        }
        
        .pending {
            color: gray;
        }
        
        .in-progress {
            color: orange;
        }
        
        .completed {
            color: green;
        }
        
        button {
            padding: 8px 15px;
            font-size: 14px;
            border: none;
            cursor: pointer;
            border-radius: 5px;
        }
        
        .start-btn {
            background: blue;
            color: white;
        }
        
        .complete-btn {
            background: green;
            color: white;
            display: none;
        }
        
        .timestamp.shipping {
            color: orange;
            /* ‡∏™‡∏µ‡∏™‡πâ‡∏°‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á */
            position: relative;
            white-space: nowrap;
            animation: marquee 5s linear infinite;
        }
        
        @keyframes marquee {
            from {
                transform: translateX(10%);
            }
            to {
                transform: translateX(-100%);
            }
        }
        
        .timestamp.delivered {
            color: green;
            /* ‡∏™‡∏µ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß */
        }
@keyframes blink {
    0% { opacity: 1; }   /* ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™‡πÄ‡∏ï‡πá‡∏° */
    50% { opacity: 0; }  /* ‡∏Å‡∏•‡∏≤‡∏á‡∏ó‡∏≤‡∏á‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÇ‡∏õ‡∏£‡πà‡∏á‡πÉ‡∏™ */
    100% { opacity: 1; } /* ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á */
}

.blink-text {
    animation: blink 1s infinite; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏£‡∏∞‡∏û‡∏£‡∏¥‡∏ö‡∏ó‡∏∏‡∏Å 1 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ */
    font-weight: bold; 
}

        
        .key-box {
            display: inline-block;
            padding: 8px 12px;
            border-radius: 12px;
            background: #a0e9ff;
            background: -webkit-linear-gradient(0deg, #a0e9ff 0%, #a8f0ff 50%, #c6f5ff 100%);
            background: linear-gradient(0deg, #a0e9ff 0%, #a8f0ff 50%, #c6f5ff 100%);
            background-color: #fff5e6;
            color: #ff9800;
            font-weight: bold;
        }
        
        h1 {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #ff9800;
            /* ‡∏™‡∏µ‡∏™‡πâ‡∏° */
            padding: 10px;
            border-radius: 10px;
            background: linear-gradient(to right, #ffcc80, #ff9800);
            color: white;
            display: inline-block;
            padding: 10px 20px;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        #loginContainer {
            text-align: center;
            margin: 20px auto;
            padding: 20px;
            width: 300px;
            background: #fff5e6;
            border-radius: 10px;
            border: 2px solid #ff9800;
            box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        #passwordInput {
            width: 80%;
            padding: 8px;
            margin: 10px 0;
            border: 1px solid #ff9800;
            border-radius: 5px;
        }
        
        button {
            background: #ff9800;
            color: white;
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.3s ease;
        }
        
        button:hover {
            background: #e68900;
        }
        
        .truck-header {
            display: flex;
            align-items: center;
            /* ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
            justify-content: center;
            /* ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô */
            gap: 10px;
            /* ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° */
        }
        
        .truck-header .fa-bounce {
            display: inline-block;
        }
        
        .driver-name {
            font-weight: bold;
            color: #007bff;
            /* ‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏ô‡πâ‡∏ô‡∏ä‡∏∑‡πà‡∏≠ */
            margin-right: 10px;
            /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏£‡∏ñ */
        }
document.addEventListener("DOMContentLoaded", () => {
    fetchData();
});

    </style>
</head>

<body>

    <h1>üöö ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ç‡∏ô‡∏™‡πà‡∏á</h1>

    <div id="loginContainer">
        <label>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (‡πÄ‡∏û‡∏∑‡πà‡∏≠Update Status):</label>
        <input type="password" id="passwordInput" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
        <button onclick="login()">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>

    <div class="container">
        <div id="truckData"></div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbxRojPjjz6nRkEG9bcubeXk6a8wtaDFsSpNL0DFcIVGc3vg7EyrNMu-rVEZJ-4Ashc-/exec";
        let loggedInTruck = null;
        let truckData = [];

        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å fetchData ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡πà‡∏≠‡∏ô
        fetchData();

        function login() {
            const password = document.getElementById("passwordInput").value;

            if (!password) {
                Swal.fire({
                    title: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô",
                    icon: "warning",
                    text: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö",
                    timer: 3000,
                    showConfirmButton: false
                });
                return;
            }

            // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÉ‡∏ô truckData ‡∏ß‡πà‡∏≤‡∏°‡∏µ license_plate ‡∏ó‡∏µ‡πà‡∏•‡∏á‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏Å‡∏°‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
            const foundTruck = truckData.find(truck => {
                // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß‡∏Ç‡∏≠‡∏á license_plate ‡∏Å‡πà‡∏≠‡∏ô
                let lastFour = null;
                if (truck.license_plate.length === 9) {
                    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ 9 ‡∏ï‡∏±‡∏ß -> ‡∏ï‡∏±‡∏î 2 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢ ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏≠‡∏≤ 4 ‡∏ï‡∏±‡∏ß‡∏´‡∏•‡∏±‡∏á
                    lastFour = truck.license_plate.slice(0, -2).slice(-4);
                } else if (truck.license_plate.length === 8) {
                    // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ 8 ‡∏ï‡∏±‡∏ß -> ‡∏ï‡∏±‡∏î 2 ‡∏ï‡∏±‡∏ß‡∏ó‡πâ‡∏≤‡∏¢ ‡πÅ‡∏•‡πâ‡∏ß‡πÄ‡∏≠‡∏≤ 4 ‡∏ï‡∏±‡∏ß‡∏´‡∏•‡∏±‡∏á
                    lastFour = truck.license_plate.slice(0, -2).slice(-4);
                }

                // ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö password
                return lastFour === password;
            });

            if (!foundTruck) {
                Swal.fire({
                    title: "‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á",
                    icon: "error",
                    text: "‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà",
                    timer: 3000,
                    showConfirmButton: false
                });
                return;
            }

            loggedInTruck = password;
            Swal.fire({
                title: "‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à",
                icon: "success",
                text: `‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏î‡πâ‡∏ß‡∏¢‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ: ${foundTruck.license_plate}`,
                timer: 3000, // ‡∏õ‡∏¥‡∏î‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÉ‡∏ô 3 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
                showConfirmButton: false // ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏° OK
            });

            renderTrucks(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
        }

function fetchData() {
    console.log("Fetching data..."); // Debug ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
    fetch(API_URL)
        .then(response => response.json())
        .then(data => {
            console.log("Data fetched:", data); // Debug ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏°‡∏≤

            // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á (‡∏ï‡∏±‡∏î‡πÅ‡∏ñ‡∏ß‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏≠‡∏≠‡∏Å)
            truckData = data.filter(row => row.date !== "‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà");

            const today = new Date();
            today.setHours(0, 0, 0, 0); // ‡∏ï‡∏±‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏¥‡πâ‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà

            truckData = truckData.filter(item => {
                if (!item.date) return false; // ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‡∏ï‡∏±‡∏î‡∏≠‡∏≠‡∏Å‡πÄ‡∏•‡∏¢

                const itemDate = new Date(item.date);
                itemDate.setHours(0, 0, 0, 0); // ‡∏ï‡∏±‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏¥‡πâ‡∏á‡πÄ‡∏ä‡πà‡∏ô‡∏Å‡∏±‡∏ô

                const isToday = itemDate.getTime() === today.getTime(); // ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
                const isFuture = itemDate.getTime() > today.getTime();  // ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ (‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)
                const isPast = itemDate.getTime() < today.getTime();    // ‡πÄ‡∏õ‡πá‡∏ô‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡πà‡∏≤

                const isNotDelivered = item.status !== "‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß"; // ‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏à‡∏±‡∏î‡∏™‡πà‡∏á
                return isToday || isFuture || (isPast && isNotDelivered);
            });

            console.log("Filtered data:", truckData); // Debug ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏ï‡∏£‡∏á‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡πÑ‡∏´‡∏°
            renderTrucks(); // ‚úÖ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å renderTrucks() ‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
        })
        .catch(error => console.error("‚ùå Error fetching data:", error));
}

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        function isToday(dateString) {
            if (!dateString) return false;

            // ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏≤‡∏Å API ‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö Date
            const dateFromAPI = new Date(dateString);
            const today = new Date();

            // ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏ß‡∏±‡∏ô ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡πÅ‡∏•‡∏∞‡∏õ‡∏µ
            return (
                dateFromAPI.getDate() === today.getDate() &&
                dateFromAPI.getMonth() === today.getMonth() &&
                dateFromAPI.getFullYear() === today.getFullYear()
            );
        }

        function updateStatus(id, newStatus) {
            if (!id) {
                console.error("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö ID ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞");
                return;
            }

            Swal.fire({
                title: "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï...",
                text: "‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞",
                icon: "info",
                showConfirmButton: false,
                allowOutsideClick: false,
                timer: 3000
            });

            const url = `${API_URL}?id=${id}&status=${encodeURIComponent(newStatus)}`;

            setTimeout(() => {
                fetch(url, {
                        method: "GET"
                    })
                    .then(response => response.json())
                    .then(result => {
                        Swal.fire({
                            title: "‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!",
                            text: "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß",
                            icon: "success",
                            timer: 1500,
                            showConfirmButton: false
                        });
                        fetchData();
                    })
                    .catch(error => {
                        console.error("‚ùå ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", error);
                        Swal.fire({
                            title: "‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!",
                            text: "‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÑ‡∏î‡πâ",
                            icon: "error"
                        });
                    });
            }, 1500);
        }

function renderTrucks() {
    const container = document.getElementById("truckData");
    container.innerHTML = "";

    const groupedByTruck = {};

    truckData.forEach(item => {
        // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ
        let lastFour = item.license_plate.length >= 4 ? item.license_plate.slice(-6, -2) : null;

        // ‚úÖ ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏±‡∏ô‡πÄ‡∏™‡∏°‡∏≠ ‡πÅ‡∏°‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô
        if (loggedInTruck && lastFour !== loggedInTruck) {
            return; // üö´ ‡∏´‡∏≤‡∏Å‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏≠‡∏¢‡∏π‡πà ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô ‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≤‡∏°
        }

        const key = `<span class="key-box">${item.license_plate} - ‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ó‡∏µ‡πà ${item.trip}</span>`;

        if (!groupedByTruck[key]) groupedByTruck[key] = [];
        groupedByTruck[key].push(item);
    });

    Object.keys(groupedByTruck).forEach(truck => {
        const truckDiv = document.createElement("div");
        truckDiv.classList.add("truck");

        const firstItem = groupedByTruck[truck][0];
        const diver = firstItem && firstItem.driver ? `<span class="driver-name">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏Ç‡∏±‡∏ö: ${firstItem.driver}</span>` : '';

        truckDiv.innerHTML = `<h2 class="truck-header"><p class="fa-bounce">üöö</p> ${diver} ${truck}</h2><ul></ul>`;

        const list = truckDiv.querySelector("ul");

        groupedByTruck[truck].forEach(item => {
            const li = document.createElement("li");

            let timestamp = item.timestamp ? formatDateTime(item.timestamp) : "";
            const timestampClass = item.status === "‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß" ? "delivered" : item.status === "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á" ? "shipping" : "";

            if (item.status === "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á") {
                timestamp = `<span style="color:orange; font-weight:bold;">
                    üöö ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á ${formatDateTime(item.timestamp)}
                 </span>`;
                }

            let customerDisplay = item.customer;

            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const itemDate = new Date(item.date);
            itemDate.setHours(0, 0, 0, 0);
            const isFuture = itemDate.getTime() > today.getTime();
	    const isPast = itemDate.getTime() < today.getTime(); 

if (isFuture) {
    const futureDate = itemDate.toLocaleDateString("th-TH", {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });

   customerDisplay += ` <span class="blink-text" style="color:green;"> ‡∏Ñ‡∏¥‡∏ß‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ${futureDate}</span>`;
} else if (isPast && item.status !== "‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß") {
    // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° "‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏•‡πà‡∏≤‡∏ä‡πâ‡∏≤" ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏≠‡∏î‡∏µ‡∏ï‡πÅ‡∏•‡∏∞‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
    customerDisplay += ` <span style="color:red;"> ‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á‡∏™‡πà‡∏á </span>`;
}

 
            li.innerHTML = `
                <span class="status">${customerDisplay}</span>
                <span class="timestamp ${timestampClass}">${timestamp}</span>
                ${loggedInTruck ? `
                    <button class="start-btn" onclick="updateStatus('${item.id}', '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á')">‡πÄ‡∏£‡∏¥‡πà‡∏°</button>
                    <button class="complete-btn" onclick="updateStatus('${item.id}', '‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß')">‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à</button>
                ` : ""}
            `;

            const startBtn = li.querySelector(".start-btn");
            const completeBtn = li.querySelector(".complete-btn");
            

            if (startBtn) {
                if (item.status === "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á") {
                    startBtn.style.display = "none";
                } else if (item.status === "‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß") {
                    startBtn.style.display = "none";
                }
            }

            if (completeBtn) {
                if (item.status === "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏à‡∏±‡∏î‡∏™‡πà‡∏á") {
                    completeBtn.style.display = "inline-block";
                } else if (item.status === "‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß") {
                    completeBtn.style.display = "none";
                }
            }

            list.appendChild(li);
        });

        container.appendChild(truckDiv);
    });
}



        function formatDateTime(timestamp) {
            if (!timestamp || isNaN(new Date(timestamp))) {
                return "";
            }

            const date = new Date(timestamp);  
            const year = date.getFullYear();   
            const month = String(date.getMonth() + 1).padStart(2, '0');  
            const day = String(date.getDate()).padStart(2, '0');  

            const hours = String(date.getHours()).padStart(2, '0');   
            const minutes = String(date.getMinutes()).padStart(2, '0');  
            const seconds = String(date.getSeconds()).padStart(2, '0');  

            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;  
        }


        // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
    fetchData();

    // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏∏‡∏Å 15 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    setInterval(fetchData, 15000);
    </script>

</body>

</html>
